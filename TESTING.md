# PromptPub 功能测试指南

## 启动项目

```bash
# 确保在项目根目录
cd /Volumes/disk/promptpub

# 启动开发服务器
bun run dev
```

访问地址：
- 前端：http://localhost:5173
- API：http://localhost:7003/api

---

## 本地 CI 检查

在执行下列功能测试前，可先运行一遍与 GitHub Actions 一致的质量脚本：

```bash
# 1. 前端 Lint（项目根目录）
bun run lint

# 2. 前端构建 + 类型检查
cd frontend && bun run build && cd ..

# 3. 数据库迁移冒烟（自动创建 ./data）
bun run db:migrate
```

若以上命令全部通过，再进入功能测试阶段，可减少环境问题导致的误报。

---

## 测试清单

### 1. 用户认证测试

#### 注册账号
1. 访问 http://localhost:5173/register
2. 填写：
   - 邮箱：test@example.com
   - 密码：test123
   - 姓名：测试用户
3. 点击注册
4. ✅ 应该自动登录并跳转到仪表盘

#### 登录测试
1. 访问 http://localhost:5173/login
2. 使用刚注册的账号登录
3. ✅ 成功进入仪表盘

---

### 2. Toast 通知测试

#### 测试位置
- 列表页复制按钮
- 详情页复制/删除/回滚
- 编辑页保存

#### 预期效果
- ✅ 右下角出现 Toast 提示
- ✅ 3秒后自动消失
- ✅ 可手动关闭
- ✅ 成功为绿色，失败为红色

---

### 3. 全文搜索测试

#### 准备数据
1. 创建一个提示词，标题："写作助手"
2. 正文内容包含："帮我写一篇关于人工智能的文章"
3. 保存

#### 测试搜索
1. 在提示词列表页搜索框输入："人工智能"
2. ✅ 应该能找到刚创建的提示词
3. 搜索："写作"
4. ✅ 应该能找到该提示词（标题匹配）

---

### 4. 版本对比测试

#### 准备数据
1. 创建一个提示词，内容："你好，我是第一版"
2. 保存后编辑，改为："你好，我是第二版，新增了这行"
3. 再次编辑，改为："你好，我是第三版"

#### 测试对比
1. 进入提示词详情页
2. 展开"版本历史"
3. 点击"版本对比"按钮
4. ✅ 界面应切换到对比模式
5. 选择两个版本（如 v1.0 和 v1.2）
6. 点击"查看差异"
7. ✅ 弹窗显示 diff 对比
8. ✅ 绿色为新增，红色为删除，白色为未变
9. ✅ 显示统计（+X -X）

---

### 5. 变量预览测试

#### 创建带变量的提示词
1. 创建新提示词
2. 内容：
   ```
   请帮我写一篇关于{topic}的{type}，
   风格要{style}，字数约{length}字。
   ```
3. 添加变量：
   - topic: 主题, 默认值: "人工智能"
   - type: 类型, 默认值: "文章"
   - style: 风格, 默认值: "专业"
   - length: 字数, 默认值: "1000"
4. 保存

#### 测试预览
1. 进入提示词详情页
2. 找到"变量设置与预览"卡片
3. 在输入框中填写：
   - topic: "区块链技术"
   - type: "博客"
   - style: "通俗易懂"
   - length: "800"
4. 点击"显示预览"
5. ✅ 预览区域应显示替换后的内容
6. ✅ 背景为渐变色（绿蓝）
7. 点击"复制预览"
8. ✅ Toast 提示"预览内容已复制"
9. 粘贴到记事本
10. ✅ 内容应该是替换后的完整文本

---

### 6. 一键复制优化测试

#### 列表页测试
1. 在提示词列表页
2. 点击某个提示词的复制按钮
3. ✅ 图标从 Copy 变为 Check（绿色）
4. ✅ 2秒后恢复
5. ✅ Toast 提示"已复制到剪贴板"

#### 详情页测试
1. 进入提示词详情页
2. 点击"复制"按钮
3. ✅ 按钮文字从"复制"变为"已复制"
4. ✅ 按钮变为蓝色
5. ✅ 2秒后恢复

---

## 常见问题

### Q: 前端无法连接后端
A: 检查后端是否在 7003 端口运行：
```bash
curl http://localhost:7003/api/health
```

### Q: Toast 不显示
A: 检查浏览器控制台是否有错误，确保 ToastProvider 已正确包裹在 App 组件外层

### Q: 版本对比弹窗不显示
A: 确保至少有 2 个版本，且已选择 2 个版本

### Q: 变量预览没有替换
A: 检查变量名是否与提示词中的占位符完全一致（包括大小写）
